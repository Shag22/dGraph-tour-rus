+++
date =  "2017-04-26T22:28:55+10:00"
next = "/basic/12"
prev = "/basic/10"
title = "Как работает поиск по графу"
weight = 11
+++

Учитывая то, что вы видели до сих пор, вы, вероятно, уже поняли как выполняется поиск. Но это стоит повторить.

Графы в Dgraph могут быть огромными, поэтому начинать поиск со всех узлов неэффективно. Для начала поиска в Dgraph нужно место, и это корневой узел.

В корневом режиме мы используем func: и функцию для поиска начального набора узлов. До сих пор мы использовали eq и allofterms для поиска строк, но поиск возможен и по другим значениям, таким как даты, числа, а также count фильтры.

Dgraph необходимо построить индекс на значениях, которые должны быть найдены таким образом, чтобы сделать поиск без индекса эффективным. Для этого Dgraph пришлось бы просматривать всю базу данных, чтобы найти совпадающие значения.

Из набора узлов, совпадающих в корневом фильтре, Dgraph затем следует за рёбрами, чтобы выполнить оставшуюся часть запроса. Фильтры на блоках внутри корня применяются только к узлам, которые можно получить следующими перечисленными рёбрами.

Корень func: принимает только одну функцию и не принимает соединения AND, OR и NOT, как в фильтрах. Поэтому синтаксис query_name(func: foo(...)) @filter(... AND ...) {...} необходим, когда требуется дальнейшая фильтрация по элементам, возвращаемым корневой функцией.

Попробуйте так: найдите всех, кому за 20, а также у кого есть не менее 2-х друзей. 

{{% expandable %}}

{
  lots_of_friends(func: ge(count(friend), 2)) @filter(ge(age, 20) AND lt(age, 30)) {
    name@.
    age
    friend {
        name@.
    }
  }
}

{{% /expandable %}}